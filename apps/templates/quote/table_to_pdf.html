{% load custom_tags %}
<!doctype html>
<html lang="en">

    <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        body {
            font-family: 'Enriqueta', arial, serif;
            font-size: x-small;
        }

        img {
            width: 200px;
            /*top: 0;
            position: absolute;*/
        }

        table {
            border-collapse: collapse;
            table-layout:fixed;
        }

        tbody {
            border-style: solid;
            border-color: black;
        }

        /*th:not(:empty)*/
        .th {
            border-style: solid;
            background-color: lightgray ;
        }

        td:not(:first-child) {
            white-space: nowrap;
        }

        td {
            border: 1px solid;
        }

        td:first-child{
            text-align: center;
            max-width: 130px;
            word-wrap:break-word;
        }

        td[rowspan="1"] {
            white-space: nowrap;
            font-stretch: ultra-condensed;
        }

        .rowspan-border {
            border:solid;
            border-right: none;
        }

        .today-fastcode {
            background-color: black;
            color: white;
            border-color: black;
        }
        
        .th-quote {
            /*width: 39px;*/
            max-width: 21px;
            word-wrap:break-word;
        }

    </style>
    </head>

    <body>
        {% with '/img/dealers/'|add:dealer_image as img %}
            <img src="data:;base64,{% image img %}"/>
        {% endwith %}
        <table class="table table-primary">
            <thead>
                <tr>
                    {% for col in columns %}
                        {% with col.sub_columns|length as sub_col_len%}
                            {% if sub_col_len > 0 %}
                                <th scope="col" colspan="{{sub_col_len}}" class="th">{{col.name}}</th>
                            {% else %}
                                <th></th>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </tr>
                <tr>
                    {% for col in columns %}
                        {% with col.sub_columns|length as sub_col_len%}
                            {% if sub_col_len == 0 %}
                                <th scope="col" class="th">{{col.name}}</th>
                            {% else %}
                                {% append_lbi forloop.counter sub_col_len %}
                                {% for c in col.sub_columns%}
                                    <th scope="col" data-sub-col="true" class="th-quote th">{{c}}</th>
                                {% endfor %}
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% comment %} {% for d_tuple in data %}
                    <tr>
                        {% for d in d_tuple %}
                            <td>{{d}}</td>
                        {% endfor %}
                    </tr>
                {% endfor%} {% endcomment %}
                {% for key, val in data.items %}
                    {% for d_tuple in val %}
                    <tr {% if val|length == forloop.counter %}style="border-bottom:solid"{%endif%}>
                        
                        {% if forloop.counter == 1 %}
                            <td rowspan="{{val|length}}" class="rowspan-border" >{{key}}</td>
                        {% endif %}

                        {% for d in d_tuple%}
                            <td class="{% if forloop.counter == 2 and d_tuple|is_today %}today-fastcode{% endif %}"
                            style="{% if forloop.counter|is_in_lbi %}border-left:solid{% endif %}" >{{d}}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>
        {% comment %} <script>
            b = document.querySelector('body')
            b.insertAdjacentHTML('afterbegin', 'DIO')
        </script> {% endcomment %}
    </body>

</html>